{% extends "base.html.twig" %}

{% block stylesheets %}
    <style>
        h5 {
            font-size: 35px;
        }
    </style>
{% endblock %}

 {% block body %}
     <link rel="stylesheet" href="{{ asset('css/back.css') }}">

     <div class="context">
         <div class="jumbotron bg-transparent">

             {% for flashMessage in app.session.flashbag.get('notice') %}
                 <div class="alert bg-success" role="alert">
                     <strong>
                         {{ flashMessage }}
                         <img src="{{ asset('img/animat-essential/checkmark/animat-checkmark.gif') }}"
                              style="height: 60px; width: 60px; -webkit-filter: invert(100%);filter: invert(100%);"
                              alt="ok">
                     </strong>
                 </div>
             {% endfor %}

             <h5 class="mb-md-5">Preston control panel</h5>

             <p style="font-size: 20px" class="mb-md-5">Welcome, {{ user.name }} !</p>

             <table id="dtBasicExample" style="font-family: 'Roboto', sans-serif !important;"
                    class="table table-borderless text-white col-12 col-lg-12">
                 <thead style="background: rgba(245,248,255,0.07);">

                 </th>
                 <th class="border-0 text-center">Id

                 </th>
                 <th class="border-0 text-center">Name

                 </th>
                 <th class="border-0 text-center">Email

                 </th>
                 <th class="border-0 text-center">Birth date

                 </th>
                 <th class="border-0 text-center">Rewards

                 </th>
                 {% if is_granted('ROLE_ADMIN') %}
                     <th class="border-0 text-center">
                         Actions
                     </th>
                 {% endif %}
                 </tr>
                 </thead>
                 <tbody class="text-white">

                 {% for u in userAndRewards %}
                     {% if u %}
                         <div class="modal fade" id="modelId" tabindex="-1" role="dialog" aria-labelledby="modelTitleId"
                              aria-hidden="true">
                             <form class="formModal" action="{{ path('add_reward', {"id" : u.id}) }}" id="form{{ u.id }}" method="post"
                                   style="font-family: 'Roboto', sans-serif !important;">
                                 <div class="modal-dialog" role="document">
                                     <div class="modal-content">
                                         <div class="modal-header">
                                             <h5 class="modal-title text-dark">Reward</h5>
                                             <button type="button" class="close" data-dismiss="modal"
                                                     aria-label="Close">
                                                 <span aria-hidden="true">&times;</span>
                                             </button>
                                         </div>
                                         <div class="modal-body">
                                             <label id="descriptionLabel" class="text-dark" for="description"></label>
                                             <textarea id="description" minlength="10" required name="description" class="w-100"
                                                       placeholder="type here ..."></textarea>
                                             <input name="tags" required type="text" id="tags">
                                         </div>
                                         <div class="modal-footer">
                                             <button type="button" class="btn btn-secondary" data-dismiss="modal">
                                                 Close
                                             </button>
                                             <button type="submit" id="btnSubmit" class="btn btn-primary">Save</button>
                                         </div>
                                     </div>
                                 </div>
                             </form>
                         </div>

                         <tr onmouseover="style='filter: drop-shadow(0px 0px 3px yellow); cursor: default'"
                             onmouseleave="style= 'filter: none;'">
                         <td class="text-center">{{ u.id }}</td>
                         <td class="text-center username{{ u.id }}">{{ u.username }}</td>
                         <td class="text-center">{{ u.email }}</td>
                         {% if u.birthdate is null %}
                             <td class="text-center">no birthdate</td>
                         {% else %}
                             <td class="text-center">{{ u.birthdate|date("d/m/Y") }}</td>
                         {% endif %}

                         <td class="">
                             <div class="d-flex justify-content-lg-center ">
                                 <a onmouseover="style='filter: drop-shadow(1px 1px 5px green); '"
                                    onmouseleave="style= 'filter: none;'" class=" openModal{{ u.id }} mr-md-4 ml-md-4"
                                    data-toggle="modal"
                                    data-target="#modelId"
                                    name="{{ u.id }}">
                                     <i class="fas fa-plus-circle cell"></i>
                                 </a>
                                 <span id="rewards{{ u.id }}">{{ u.rewardsJoined|length }}</span>
                                 {% if u.rewardsJoined|length == 0 %}
                                     <a id="rewardBalloon{{ u.id }}" class="mr-md-4 ml-md-4"><i
                                                 class="far fa-eye"></i></a>
                                 {% else %}
                                     <a id="rewardBalloon{{ u.id }}"
                                        href="{{ path('show_user_rewards', {'id' : u.id}) }}"
                                        class="mr-md-4 ml-md-4"><i class="far fa-eye"></i></a>
                                 {% endif %}

                                 <div style="filter: drop-shadow(60px 60px white)"></div>

                             </div>
                         </td>
                         {% if is_granted('ROLE_ADMIN') %}
                             <td class="text-center">
                                 <a href="{{ path("edit_user", {"id": u.id}) }}">edit</a>
                             </td>
                             </tr>
                         {% endif %}
                         <script>
                             $(document).ready(function () {
                                 {% if u.rewardsJoined|length == 0 %}
                                 {% set rewards = "no rewards" %}
                                 {% else %}
                                 {% set rewards = u.rewardsJoined|join(", ") %}
                                 {% endif %}
                                 $("#rewardBalloon{{ u.id }}").balloon({
                                     html: true,
                                     contents: $("<p style='font-family: `lato`, sans-serif; font-size: 15px; width: 150px'>{{ rewards }}</p>")
                                 });
                             })
                         </script>
                     {% endif %}
                 {% endfor %}
                 </tbody>

                 <tfoot style="background: rgba(245,248,255,0.07);">
                 <tr>
                     <th class="border-0 text-center">Id</th>
                     <th class="border-0 text-center">Name
                     </th>
                     <th class="border-0 text-center">Email
                     </th>
                     <th class="border-0 text-center">Birth date
                     </th>
                     <th class="border-0 text-center">Rewards
                     </th>
                     {% if is_granted('ROLE_ADMIN') %}
                         <th class="border-0 text-center">
                             Actions
                         </th>
                     {% endif %}
                 </tr>
                 </tfoot>
             </table>
         </div>
     </div>
     <div class="area">
         <ul class="circles">
             <li></li>
             <li></li>
             <li></li>
             <li></li>
             <li></li>
             <li></li>
             <li></li>
             <li></li>
             <li></li>
             <li></li>
         </ul>
     </div>

     <script src="{{ asset('js/tooltip.js') }}"></script>
     <script>
         // Basic example
         $(document).ready(function () {
             $('#dtBasicExample').DataTable({
                 responsive: true
             });
             $('.dataTables_length').addClass('bs-select');

             {% for u in userAndRewards %}
             {% if u %}

             $(document).on("click", ".openModal{{ u.id }}", function () {
                 var id = $(".openModal{{ u.id }}").attr("name");
                 var nome = "{{ u.username }}";
                 $('.formModal').attr("name", id);
                 $('.formModal').attr("id", "form" + id);
                 $('.formModal').attr("action", "{{ path('add_reward', {"id": u.id}) }}");
                 $('.modal-title').text("Reward " + nome);
                 $('#descriptionLabel').text("Why are you rewarding {{ u.username }} ?");
             });


             {% endif %}
             {% endfor %}

         });
         {% for u in userAndRewards %}
         {% if u %}
         {#$(function () {#}
         {#    $(document).on("submit", "#form{{ u.id }}", function () {#}

         {#        $("#btnSubmit").attr("disabled", true).html("wait").cursor("default");#}

         {#        var description = $("#description");#}
         {#        var inputs = $("#tags");#}

         {#        var values = {};#}

         {#        inputs.each(function () {#}
         {#            values[this.name] = $(this).val();#}
         {#        });#}
         {#        $(function () {#}
         {#            $.ajax({#}
         {#                type: 'POST',#}
         {#                data: {values, description},#}
         {#                url: '{{ path('add_reward', {"id": u.id}) }}',#}
         {#                success: function () {#}
         {#                    Command: toastr["success"]("User {{ u.username }} rewarded");#}

         {#                    toastr.options = {#}
         {#                        "closeButton": true,#}
         {#                        "debug": false,#}
         {#                        "newestOnTop": true,#}
         {#                        "progressBar": true,#}
         {#                        "positionClass": "toast-bottom-center",#}
         {#                        "preventDuplicates": false,#}
         {#                        "onclick": null,#}
         {#                        "showDuration": "300",#}
         {#                        "hideDuration": "1000",#}
         {#                        "timeOut": "5000",#}
         {#                        "extendedTimeOut": "1000",#}
         {#                        "showEasing": "swing",#}
         {#                        "hideEasing": "linear",#}
         {#                        "showMethod": "fadeIn",#}
         {#                        "hideMethod": "fadeOut",#}
         {#                        "shadowColor": "none"#}
         {#                    };#}
         {#                    console.log("ok")#}
         {#                },#}
         {#                error: function () {#}
         {#                    Command: toastr["error"]("User {{ u.username }} cannot be rewarded");#}

         {#                    toastr.options = {#}
         {#                        "closeButton": true,#}
         {#                        "debug": false,#}
         {#                        "newestOnTop": true,#}
         {#                        "progressBar": true,#}
         {#                        "positionClass": "toast-bottom-center",#}
         {#                        "preventDuplicates": false,#}
         {#                        "onclick": null,#}
         {#                        "showDuration": "300",#}
         {#                        "hideDuration": "1000",#}
         {#                        "timeOut": "5000",#}
         {#                        "extendedTimeOut": "1000",#}
         {#                        "showEasing": "swing",#}
         {#                        "hideEasing": "linear",#}
         {#                        "showMethod": "fadeIn",#}
         {#                        "hideMethod": "fadeOut",#}
         {#                    };#}
         {#                    console.log(`{{ path('add_reward', {"id": u.id}) }}`)#}
         {#                }#}
         {#            });#}
         {#        });#}
         {#        $(function () {#}
         {#            $.ajax({#}
         {#                type: 'GET',#}
         {#                data: values,#}
         {#                url: '{{ path('amount_rewards', {"id": u.id}) }}',#}
         {#                success: function (response) {#}
         {#                    $("#rewards{{ u.id }}").html("<span>" + response + "</span>");#}
         {#                }#}
         {#            });#}
         {#        })#}
         {#    });#}
         {#});#}
         {% endif %}
         {% endfor %}

         var tagsdata = []
         tagsdata.push({id: 1, name: "Dare", screen: "dare"});
         tagsdata.push({id: 2, name: "Create", screen: "create"});
         tagsdata.push({id: 3, name: "Do it", screen: "do it"});
         tagsdata.push({id: 4, name: "Connect", screen: "connect"});

         $("#tags").sTags({
             data: tagsdata,
             color: 1
         });
         $(".sTags").attr({"class": "d-flex justify-content-between"});

     </script>

 {% endblock %}
